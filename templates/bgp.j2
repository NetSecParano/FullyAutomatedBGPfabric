#jinja2:lstrip_blocks: True
#jinja2:trim_blocks: True
frr version 3.1+cl3u3
frr defaults datacenter
username cumulus nopassword
!
service integrated-vtysh-config
!
log syslog informational
!
router bgp {{ as }}
{% if ansible_fqdn in groups['spines'] or ansible_fqdn in groups['leafs'] -%}
 neighbor DOWNSTREAM peer-group
 neighbor DOWNSTREAM remote-as external
  {% if option is not defined -%}
 bgp listen range 10.{{ range }}.0.0/16 peer-group DOWNSTREAM
  {% endif -%}
{% endif -%}
{% if option is defined  or ansible_fqdn not in groups['spines']  -%}
  {% for int in interfaces -%}
{#    {% if int.up -%} #}
 neighbor {{ int.name }} interface remote-as external 
{#    {% endif -%} #}
  {% endfor -%}
{% endif -%}
{% if ansible_fqdn in groups['servers'] -%}
  {% if option is defined and option == "ipv6" -%}
 ad ipv6
   redistribute connected
  {% else -%}
 ad ipv4
   redistribute connected
  {% endif -%}

{% endif -%}
bgp best as-pa mul
{% if option is defined and option == "ipv6" -%}
no bgp default ipv4-unicast
ad ipv6
maximum 10  
  {% for int in interfaces -%}
 neighbor {{ int.name }} activate
  {% endfor -%}
{% else -%}
ad ipv4
maximum 10
{% endif -%}
!
line vty
!