---
- name: Add network interfaces
  template: 
    src: interfaces.j2
    dest: /etc/network/interfaces

- name: Flushing previous configurations
  shell: ip addr flush dev "{{ item.name }}" && ifup "{{ item.name }}" --force
  with_items: 
    - "{{ interfaces }}"
  ignore_errors: yes

- name: Restart networking service
  service: 
    name: networking
    state: restarted

- name: In case of unreachables because of network restart, we flush the unreachable state
  meta: clear_host_errors
